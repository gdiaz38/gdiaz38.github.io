<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMDb Movie Analysis Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 16px;
            border: 1px solid #334155;
        }

        .header h1 {
            font-size: 3rem;
            color: #f1c40f;
            margin-bottom: 12px;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(241, 196, 15, 0.3);
        }

        .header p {
            color: #94a3b8;
            font-size: 1.2rem;
            font-weight: 300;
        }

        .upload-section {
            background: #1e293b;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #334155;
            text-align: center;
        }

        .upload-area {
            border: 2px dashed #475569;
            border-radius: 8px;
            padding: 40px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #f1c40f;
            background: rgba(241, 196, 15, 0.05);
        }

        .file-input {
            display: none;
        }

        .load-button {
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            color: #0f172a;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin: 16px 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .load-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(241, 196, 15, 0.3);
        }

        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .controls {
            background: #1e293b;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #334155;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            align-items: start;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .filter-group label {
            font-weight: 600;
            color: #f1c40f;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input {
            padding: 12px 16px;
            border: 1px solid #475569;
            border-radius: 8px;
            background: #0f172a;
            color: #e2e8f0;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #f1c40f;
            box-shadow: 0 0 0 3px rgba(241, 196, 15, 0.1);
        }

        select[multiple] {
            min-height: 120px;
        }

        .select-all-btn {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            color: #e2e8f0;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
        }

        .select-all-btn:hover {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .metric-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 28px;
            border-radius: 16px;
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
            border-color: #f1c40f;
        }

        .metric-label {
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #f1c40f;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(241, 196, 15, 0.3);
        }

        .metric-subtitle {
            font-size: 0.85rem;
            color: #64748b;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .chart-container {
            background: #1e293b;
            padding: 28px;
            border-radius: 16px;
            border: 1px solid #334155;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #f1c40f;
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chart-canvas {
            position: relative;
            height: 350px;
        }

        .data-table-section {
            background: #1e293b;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #334155;
            margin-bottom: 32px;
        }

        .table-header {
            padding: 24px 28px;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
        }

        .table-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #f1c40f;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table {
            overflow-x: auto;
            max-height: 500px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }

        th {
            background: #0f172a;
            font-weight: 600;
            color: #f1c40f;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: #e2e8f0;
        }

        tr:hover td {
            background: #334155;
        }

        .insights-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        .insight-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 16px;
            padding: 28px;
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }

        .insight-card:hover {
            transform: translateY(-2px);
            border-color: #f1c40f;
        }

        .insight-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #f1c40f;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .insight-text {
            color: #cbd5e1;
            line-height: 1.7;
        }

        .insight-text strong {
            color: #f1c40f;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 60px;
            color: #94a3b8;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #334155;
            border-top: 3px solid #f1c40f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .rating-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .rating-excellent {
            background: #10b981;
            color: #ecfdf5;
        }

        .rating-good {
            background: #f59e0b;
            color: #fffbeb;
        }

        .rating-average {
            background: #6b7280;
            color: #f9fafb;
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .container {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>IMDb Movie Analysis</h1>
            <p>Interactive dashboard for analyzing movie ratings, genres, and trends</p>
        </div>

        <div class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea">
                <div style="font-size: 4rem; margin-bottom: 20px; color: #f1c40f;">🎬</div>
                <div style="font-size: 1.3rem; margin-bottom: 10px; color: #e2e8f0;">Drop your IMDb CSV file here</div>
                <div style="color: #94a3b8; font-size: 1rem;">Or click to browse for your IMDb dataset</div>
                <input type="file" class="file-input" id="fileInput" accept=".csv">
            </div>
            <button class="load-button" onclick="loadLocalCSV()">Load IMDb.csv from Project</button>
            <div style="margin-top: 20px; color: #94a3b8; font-size: 0.95rem;">
                Expected file: <strong>IMDb.csv</strong> with columns: Movie Name, Rating, Runtime, Genre, Directors, Stars, Votes, etc.
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Processing movie data...</p>
        </div>

        <div class="dashboard" id="dashboard">
            <div class="controls">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="genreFilter">Genre Selection</label>
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <button type="button" class="select-all-btn" onclick="selectAllGenres()">Select All</button>
                            <button type="button" class="select-all-btn" onclick="clearAllGenres()">Clear All</button>
                        </div>
                        <select id="genreFilter" multiple>
                        </select>
                        <small style="color: #64748b; font-size: 0.8rem; margin-top: 4px;">Hold Ctrl/Cmd to select multiple genres</small>
                    </div>
                    <div class="filter-group">
                        <label for="ratingFilter">Minimum Rating</label>
                        <select id="ratingFilter">
                            <option value="0">All Ratings</option>
                            <option value="4">4.0+</option>
                            <option value="4.5">4.5+</option>
                            <option value="5">5.0+</option>
                            <option value="5.5">5.5+</option>
                            <option value="6">6.0+</option>
                            <option value="6.5">6.5+</option>
                            <option value="7">7.0+</option>
                            <option value="7.5">7.5+</option>
                            <option value="8">8.0+</option>
                            <option value="8.5">8.5+</option>
                            <option value="9">9.0+</option>
                            <option value="9.5">9.5+</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="metrics-grid" id="metricsGrid">
                <!-- Metrics will be populated by JavaScript -->
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3 class="chart-title">Rating Distribution</h3>
                    <div class="chart-canvas">
                        <canvas id="ratingChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Top Genres</h3>
                    <div class="chart-canvas">
                        <canvas id="genreChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="data-table-section">
                <div class="table-header">
                    <h3 class="table-title">Movie Database</h3>
                    <span id="recordCount" style="color: #94a3b8; font-size: 0.9rem;"></span>
                </div>
                <div class="data-table">
                    <table id="dataTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="insights-section">
                <div class="insight-card">
                    <div class="insight-title">Top Performers</div>
                    <div id="topMoviesInsights" class="insight-text"></div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">Genre Analysis</div>
                    <div id="genreInsights" class="insight-text"></div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">Statistical Summary</div>
                    <div id="statisticalInsights" class="insight-text"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allMovies = [];
        let filteredMovies = [];
        let charts = {};

        // File upload handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#f1c40f';
            uploadArea.style.background = 'rgba(241, 196, 15, 0.05)';
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#475569';
            uploadArea.style.background = '';
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#475569';
            uploadArea.style.background = '';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file.name.toLowerCase().includes('.csv')) {
                alert('Please upload a CSV file');
                return;
            }

            showLoading();

            Papa.parse(file, {
                complete: function(results) {
                    processMovieData(results.data);
                },
                header: true,
                skipEmptyLines: true,
                dynamicTyping: true
            });
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('dashboard').classList.remove('active');
        }

        // Load the local IMDb.csv file using Papa.parse download
        function loadLocalCSV() {
            showLoading();
            
            Papa.parse('IMDb.csv', {
                download: true,
                header: true,
                skipEmptyLines: true,
                dynamicTyping: true,
                complete: (results) => {
                    console.log('IMDb.csv loaded successfully');
                    console.log(`Total rows: ${results.data.length}`);
                    processMovieData(results.data);
                },
                error: (error) => {
                    console.error('Error loading IMDb.csv:', error);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('uploadSection').style.display = 'block';
                    alert('Could not load IMDb.csv. Make sure it is in the same folder as this HTML file.\n\nError: ' + error.message);
                }
            });
        }

        function processMovieData(data) {
            console.log('Raw data sample:', data.slice(0, 3));

            // Clean and normalize the data
            allMovies = data.filter(movie => 
                movie['Rating'] && 
                parseFloat(movie['Rating']) > 0 &&
                movie['Movie Name']
            ).map(movie => {
                // Parse runtime
                let runtime = 0;
                if (movie['Runtime']) {
                    const runtimeMatch = movie['Runtime'].toString().match(/\d+/);
                    runtime = runtimeMatch ? parseInt(runtimeMatch[0]) : 0;
                }

                // Parse gross revenue
                let gross = 0;
                if (movie['Gross']) {
                    gross = parseFloat(movie['Gross']) || 0;
                }

                // Clean genre - keep all genres for multiple genre support
                let genres = [];
                if (movie['Genre']) {
                    genres = movie['Genre'].split(',').map(g => g.trim()).filter(g => g);
                }
                const primaryGenre = genres[0] || 'Unknown';

                // Get directors - clean up the array format
                let director = 'Unknown';
                if (movie['Directors']) {
                    if (typeof movie['Directors'] === 'string') {
                        director = movie['Directors']
                            .replace(/[\[\]']/g, '')
                            .split(',')[0]
                            .trim();
                    }
                }

                return {
                    id: movie['ID'] || 0,
                    title: movie['Movie Name'] || '',
                    rating: parseFloat(movie['Rating']) || 0,
                    genre: primaryGenre,
                    genres: genres, // Store all genres
                    director: director,
                    runtime: runtime,
                    votes: parseInt(movie['Votes']) || 0,
                    gross: gross,
                    metascore: parseInt(movie['Metascore']) || 0,
                    plot: movie['Plot'] || ''
                };
            });

            console.log('Processed movies sample:', allMovies.slice(0, 3));

            // Sort by rating descending
            allMovies.sort((a, b) => b.rating - a.rating);

            filteredMovies = [...allMovies];
            
            updateDashboard();
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
        }

        function updateDashboard() {
            updateFilters();
            updateMetrics();
            updateCharts();
            updateTable();
            updateInsights();
        }

        function updateFilters() {
            // Update genre filter with all unique genres
            const allGenres = new Set();
            allMovies.forEach(movie => {
                if (movie.genres && movie.genres.length > 0) {
                    movie.genres.forEach(genre => {
                        if (genre && genre !== 'Unknown') {
                            allGenres.add(genre);
                        }
                    });
                } else if (movie.genre && movie.genre !== 'Unknown') {
                    allGenres.add(movie.genre);
                }
            });
            
            const genres = Array.from(allGenres).sort();
            const genreSelect = document.getElementById('genreFilter');
            const currentValues = Array.from(genreSelect.selectedOptions).map(option => option.value);
            
            genreSelect.innerHTML = '';
            genres.forEach(genre => {
                const option = document.createElement('option');
                option.value = genre;
                option.textContent = genre;
                if (currentValues.includes(genre)) {
                    option.selected = true;
                }
                genreSelect.appendChild(option);
            });
        }

        function selectAllGenres() {
            const genreSelect = document.getElementById('genreFilter');
            for (let option of genreSelect.options) {
                option.selected = true;
            }
            applyFilters();
        }

        function clearAllGenres() {
            const genreSelect = document.getElementById('genreFilter');
            for (let option of genreSelect.options) {
                option.selected = false;
            }
            applyFilters();
        }

        function applyFilters() {
            const genreSelect = document.getElementById('genreFilter');
            const selectedGenres = Array.from(genreSelect.selectedOptions).map(option => option.value);
            const ratingFilter = parseFloat(document.getElementById('ratingFilter').value);

            filteredMovies = allMovies.filter(movie => {
                // Genre filter - if no genres selected, show all movies
                let genreMatch = selectedGenres.length === 0;
                if (!genreMatch && selectedGenres.length > 0) {
                    if (movie.genres && movie.genres.length > 0) {
                        genreMatch = movie.genres.some(genre => selectedGenres.includes(genre));
                    } else {
                        genreMatch = selectedGenres.includes(movie.genre);
                    }
                }
                
                const ratingMatch = movie.rating >= ratingFilter;

                return genreMatch && ratingMatch;
            });

            updateMetrics();
            updateCharts();
            updateTable();
            updateInsights();
        }

        function updateMetrics() {
            const totalMovies = filteredMovies.length;
            const avgRating = totalMovies > 0 ? filteredMovies.reduce((sum, m) => sum + m.rating, 0) / totalMovies : 0;
            const topRating = totalMovies > 0 ? Math.max(...filteredMovies.map(m => m.rating)) : 0;
            const totalVotes = filteredMovies.reduce((sum, m) => sum + m.votes, 0);

            document.getElementById('metricsGrid').innerHTML = `
                <div class="metric-card">
                    <div class="metric-label">Total Movies</div>
                    <div class="metric-value">${totalMovies.toLocaleString()}</div>
                    <div class="metric-subtitle">In filtered results</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Average Rating</div>
                    <div class="metric-value">${avgRating.toFixed(1)}</div>
                    <div class="metric-subtitle">Out of 10.0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Highest Rating</div>
                    <div class="metric-value">${topRating.toFixed(1)}</div>
                    <div class="metric-subtitle">Best movie rating</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total Votes</div>
                    <div class="metric-value">${totalVotes > 1000000 ? (totalVotes / 1000000).toFixed(1) + 'M' : Math.floor(totalVotes / 1000) + 'K'}</div>
                    <div class="metric-subtitle">Community engagement</div>
                </div>
            `;
        }

        function updateCharts() {
            updateRatingChart();
            updateGenreChart();
        }

        function updateRatingChart() {
            // Create rating distribution bins
            const ratingBins = {};
            for (let i = 1; i <= 10; i += 0.5) {
                ratingBins[i.toFixed(1)] = 0;
            }
            
            filteredMovies.forEach(movie => {
                const bin = (Math.round(movie.rating * 2) / 2).toFixed(1);
                if (ratingBins[bin] !== undefined) {
                    ratingBins[bin]++;
                }
            });

            if (charts.rating) charts.rating.destroy();
            
            const ctx = document.getElementById('ratingChart').getContext('2d');
            charts.rating = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(ratingBins).filter(key => ratingBins[key] > 0),
                    datasets: [{
                        label: 'Number of Movies',
                        data: Object.keys(ratingBins).filter(key => ratingBins[key] > 0).map(key => ratingBins[key]),
                        backgroundColor: '#f1c40f',
                        borderColor: '#f39c12',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        }
                    }
                }
            });
        }

        function updateGenreChart() {
            const genreCounts = {};
            
            // Count all genres (including from movies with multiple genres)
            filteredMovies.forEach(movie => {
                if (movie.genres && movie.genres.length > 0) {
                    movie.genres.forEach(genre => {
                        if (genre && genre !== 'Unknown') {
                            genreCounts[genre] = (genreCounts[genre] || 0) + 1;
                        }
                    });
                } else if (movie.genre && movie.genre !== 'Unknown') {
                    genreCounts[movie.genre] = (genreCounts[movie.genre] || 0) + 1;
                }
            });

            // Get top 8 genres
            const sortedGenres = Object.entries(genreCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);

            if (charts.genre) charts.genre.destroy();

            const ctx = document.getElementById('genreChart').getContext('2d');
            charts.genre = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedGenres.map(([genre]) => genre),
                    datasets: [{
                        data: sortedGenres.map(([, count]) => count),
                        backgroundColor: [
                            '#f1c40f', '#e74c3c', '#3498db', '#2ecc71', 
                            '#9b59b6', '#e67e22', '#1abc9c', '#34495e'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                color: '#94a3b8',
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function updateTable() {
            const displayMovies = filteredMovies.slice(0, 50);
            
            // Update record count
            document.getElementById('recordCount').textContent = 
                `Showing ${displayMovies.length} of ${filteredMovies.length} movies`;
            
            // Update table header - removed Year column
            const tableHead = document.getElementById('tableHead');
            tableHead.innerHTML = `
                <tr>
                    <th>Rank</th>
                    <th>Title</th>
                    <th>Rating</th>
                    <th>Runtime</th>
                    <th>Genre</th>
                    <th>Director</th>
                    <th>Votes</th>
                </tr>
            `;
            
            // Update table body - removed year display
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = displayMovies.map((movie, index) => {
                let ratingBadge = 'rating-average';
                if (movie.rating >= 9.0) ratingBadge = 'rating-excellent';
                else if (movie.rating >= 8.0) ratingBadge = 'rating-good';
                
                // Display all genres for movies with multiple genres
                const genreDisplay = movie.genres && movie.genres.length > 0 
                    ? movie.genres.join(', ') 
                    : movie.genre;
                
                return `
                    <tr>
                        <td><strong>#${index + 1}</strong></td>
                        <td><strong>${movie.title}</strong></td>
                        <td><span class="rating-badge ${ratingBadge}">${movie.rating.toFixed(1)}</span></td>
                        <td>${movie.runtime ? movie.runtime + ' min' : 'N/A'}</td>
                        <td>${genreDisplay}</td>
                        <td>${movie.director}</td>
                        <td>${movie.votes.toLocaleString()}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateInsights() {
            // Top movies insights - removed year references
            const topMovies = filteredMovies.slice(0, 5);
            const topMoviesText = topMovies.map((movie, i) => 
                `<strong>${i + 1}. ${movie.title}</strong> (${movie.rating}/10)`
            ).join('<br>');

            document.getElementById('topMoviesInsights').innerHTML = `
                <p><strong>Highest Rated Movies:</strong></p>
                <div style="margin-top: 12px; line-height: 1.8;">
                    ${topMoviesText || 'No movies found'}
                </div>
            `;

            // Genre insights
            const genreCounts = {};
            const genreRatings = {};
            
            // Count all genres including multiple genres per movie
            filteredMovies.forEach(movie => {
                const movieGenres = movie.genres && movie.genres.length > 0 ? movie.genres : [movie.genre];
                
                movieGenres.forEach(genre => {
                    if (genre && genre !== 'Unknown') {
                        genreCounts[genre] = (genreCounts[genre] || 0) + 1;
                        if (!genreRatings[genre]) genreRatings[genre] = [];
                        genreRatings[genre].push(movie.rating);
                    }
                });
            });

            const mostPopularGenre = Object.entries(genreCounts)
                .sort(([,a], [,b]) => b - a)[0];

            const bestRatedGenre = Object.entries(genreRatings)
                .map(([genre, ratings]) => [
                    genre, 
                    ratings.reduce((sum, r) => sum + r, 0) / ratings.length
                ])
                .sort(([,a], [,b]) => b - a)[0];

            document.getElementById('genreInsights').innerHTML = `
                <p><strong>Most Popular Genre:</strong> ${mostPopularGenre ? mostPopularGenre[0] : 'N/A'} with ${mostPopularGenre ? mostPopularGenre[1] : 0} movies</p>
                <p><strong>Highest Rated Genre:</strong> ${bestRatedGenre ? bestRatedGenre[0] : 'N/A'} ${bestRatedGenre ? `(avg: ${bestRatedGenre[1].toFixed(1)}/10)` : ''}</p>
                <p><strong>Total Genres:</strong> ${Object.keys(genreCounts).length} different genres represented</p>
            `;

            // Statistical insights
            if (filteredMovies.length === 0) {
                document.getElementById('statisticalInsights').innerHTML = `
                    <p><strong>No movies match the current filters</strong></p>
                    <p>Try adjusting your search criteria</p>
                `;
                return;
            }

            const ratings = filteredMovies.map(m => m.rating);
            const avgRating = ratings.reduce((sum, r) => sum + r, 0) / ratings.length;
            const sortedRatings = [...ratings].sort((a, b) => a - b);
            const median = sortedRatings[Math.floor(sortedRatings.length / 2)];
            const stdDev = Math.sqrt(
                ratings.reduce((sum, r) => sum + Math.pow(r - avgRating, 2), 0) / ratings.length
            );

            const excellentMovies = filteredMovies.filter(m => m.rating >= 9.0).length;
            const goodMovies = filteredMovies.filter(m => m.rating >= 8.0 && m.rating < 9.0).length;
            const totalVotes = filteredMovies.reduce((sum, m) => sum + m.votes, 0);
            const avgVotes = totalVotes / filteredMovies.length;

            // Add runtime statistics
            const runtimes = filteredMovies.filter(m => m.runtime > 0).map(m => m.runtime);
            const avgRuntime = runtimes.length > 0 ? runtimes.reduce((sum, r) => sum + r, 0) / runtimes.length : 0;

            document.getElementById('statisticalInsights').innerHTML = `
                <p><strong>Mean Rating:</strong> ${avgRating.toFixed(2)}/10</p>
                <p><strong>Median Rating:</strong> ${median.toFixed(1)}/10</p>
                <p><strong>Standard Deviation:</strong> ${stdDev.toFixed(2)}</p>
                <p><strong>Distribution:</strong> ${excellentMovies} excellent (9.0+), ${goodMovies} very good (8.0-8.9)</p>
                <p><strong>Average Runtime:</strong> ${Math.floor(avgRuntime)} minutes</p>
                <p><strong>Average Votes:</strong> ${Math.floor(avgVotes).toLocaleString()} per movie</p>
            `;
        }

        // Event listeners for filters
        document.getElementById('genreFilter').addEventListener('change', applyFilters);
        document.getElementById('ratingFilter').addEventListener('change', applyFilters);
    </script>
</body>
</html>
